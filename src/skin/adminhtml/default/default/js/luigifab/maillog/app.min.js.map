{"version":3,"sources":["app.js"],"sourcesContent":["/**\n * Created J/03/12/2015\n * Updated L/18/10/2021\n *\n * Copyright 2015-2022 | Fabrice Creuzot (luigifab) <code~luigifab~fr>\n * Copyright 2015-2016 | Fabrice Creuzot <fabrice.creuzot~label-park~com>\n * Copyright 2017-2018 | Fabrice Creuzot <fabrice~reactive-web~fr>\n * Copyright 2020-2022 | Fabrice Creuzot <fabrice~cellublue~com>\n * https://www.luigifab.fr/openmage/maillog\n *\n * This program is free software, you can redistribute it or modify\n * it under the terms of the GNU General Public License (GPL) as published\n * by the free software foundation, either version 2 of the license, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but without any warranty, without even the implied warranty of\n * merchantability or fitness for a particular purpose. See the\n * GNU General Public License (GPL) for more details.\n */\n\nif (window.NodeList && !NodeList.prototype.forEach) {\n\tNodeList.prototype.forEach = function (callback, that, i) {\n\t\tthat = that || window;\n\t\tfor (i = 0; i < this.length; i++)\n\t\t\tcallback.call(that, this[i], i, this);\n\t};\n}\n\nvar maillog = new (function () {\n\n\t\"use strict\";\n\tthis.template = null;\n\tthis.nextIdx  = 0;\n\n\tthis.init = function () {\n\n\t\tvar elem, customer, bounce, subscriber, i, j;\n\n\t\tif (document.getElementById('maillog_sync_bounces_stats_customer')) {\n\n\t\t\tconsole.info('maillog.app - hello');\n\t\t\tcustomer   = document.getElementById('maillog_sync_bounces_stats_customer');\n\t\t\tbounce     = document.getElementById('maillog_sync_bounces_stats_bounce');\n\t\t\tsubscriber = document.getElementById('maillog_sync_unsubscribers_stats_subscriber');\n\n\t\t\ti = parseInt(customer.textContent.trim(), 10);\n\t\t\tj = parseInt(bounce.textContent.trim(), 10);\n\t\t\tbounce.textContent += ' (' + Math.floor(j * 100 / i) + ' %)';\n\n\t\t\ti = parseInt(customer.textContent.trim(), 10);\n\t\t\tj = parseInt(subscriber.textContent.trim(), 10);\n\t\t\tsubscriber.textContent += ' (' + Math.floor(j * 100 / i) + ' %)';\n\t\t}\n\t\telse if (elem = document.getElementById('row_maillog_directives_general_special_config')) {\n\n\t\t\tconsole.info('maillog.app - hello');\n\t\t\telem = elem.querySelector('tr.template');\n\n\t\t\tthis.template = elem.innerHTML;\n\t\t\tthis.nextIdx  = parseInt(elem.getAttribute('data-next'), 10);\n\n\t\t\telem.remove();\n\t\t}\n\t};\n\n\tthis.add = function (code) {\n\n\t\tvar sys = document.getElementById('maillog_sync_' + code + '_mapping_system'),\n\t\t    mag = document.getElementById('maillog_sync_' + code + '_mapping_openmage'),\n\t\t    cnf = document.getElementById('maillog_sync_' + code + '_mapping_config');\n\n\t\tif ((sys.value.length > 0) && (mag.value.length > 0)) {\n\t\t\tcnf.value = (cnf.value + '\\n' + sys.value + ':' + mag.value).trim();\n\t\t\tcnf.scrollTop = cnf.scrollHeight;\n\t\t\tsys.selectedIndex = 0;\n\t\t\tmag.selectedIndex = 0;\n\t\t\tthis.mark(code);\n\t\t}\n\t};\n\n\tthis.mark = function (code) {\n\n\t\tvar fields = document.getElementById('maillog_sync_' + code + '_mapping_config').value;\n\n\t\tdocument.getElementById('maillog_sync_' + code + '_mapping_system').querySelectorAll('option').forEach(function (elem) {\n\t\t\tif ((fields.indexOf('\\n' + elem.value + ':') > -1) || (fields.indexOf(elem.value + ':') === 0))\n\t\t\t\telem.setAttribute('class', 'has');\n\t\t\telse\n\t\t\t\telem.removeAttribute('class');\n\t\t});\n\n\t\tdocument.getElementById('maillog_sync_' + code + '_mapping_openmage').querySelectorAll('option').forEach(function (elem) {\n\t\t\tif (fields.indexOf(':' + elem.value) > -1)\n\t\t\t\telem.setAttribute('class', 'has');\n\t\t\telse\n\t\t\t\telem.removeAttribute('class');\n\t\t});\n\t};\n\n\tthis.decode = function (data) {\n\t\t// utf-8 avec Webkit (https://stackoverflow.com/q/3626183)\n\t\treturn decodeURIComponent(escape(atob(data)));\n\t};\n\n\tthis.iframe = function (elem) {\n\n\t\ttry {\n\t\t\telem.removeAttribute('onload');\n\t\t\telem.contentDocument.querySelector('body').parentNode.innerHTML = this.decode(elem.firstChild.nodeValue);\n\t\t\telem.style.height = elem.contentDocument.querySelector('body').scrollHeight + 'px';\n\t\t\tself.setTimeout(function () {\n\t\t\t\tvar elem = document.querySelector('div.content iframe');\n\t\t\t\telem.style.height = elem.contentDocument.querySelector('body').scrollHeight + 'px';\n\t\t\t}, 1000);\n\t\t}\n\t\tcatch (e) {\n\t\t\telem.contentDocument.querySelector('body').textContent = e;\n\t\t}\n\t};\n\n\tthis.resetLifetime = function (elem, color) {\n\n\t\telem = elem.parentNode;\n\t\telem.querySelectorAll('select')[0].selectedIndex = 0;\n\t\telem.querySelectorAll('select')[1].selectedIndex = 0;\n\t\telem.querySelectorAll('input')[0].value = color.toLowerCase();\n\t\telem.querySelectorAll('input')[1].value = '#000000';\n\t};\n\n\tthis.removeLifetime = function (elem) {\n\n\t\tif (confirm(Translator.translate('Are you sure?')))\n\t\t\telem.parentNode.remove();\n\t};\n\n\tthis.addPicture = function (elem) {\n\n\t\tvar tpl = document.createElement('tr'), root = elem.parentNode;\n\t\twhile (root.nodeName !== 'TABLE')\n\t\t\troot = root.parentNode;\n\n\t\troot = root.querySelector('tbody');\n\n\t\ttpl.setAttribute('class', 'added');\n\t\ttpl.innerHTML = this.template.\n\t\t\treplace(/IIDDXX/g, this.nextIdx).\n\t\t\treplace(/KKEEYY/g, '1');\n\n\t\troot.appendChild(tpl);\n\t\tthis.nextIdx += 1;\n\t};\n\n\tthis.deletePicture = function (elem) {\n\n\t\tvar empty = true;\n\t\telem.parentNode.parentNode.querySelectorAll('input').forEach(function (input) { empty = empty && (input.value == ''); });\n\n\t\tif (empty || confirm(Translator.translate('Are you sure?')))\n\t\t\telem.parentNode.parentNode.remove();\n\t};\n\n\tthis.addBreak = function (elem, idx) {\n\n\t\tvar tpl = document.createElement('ul'), ul = elem.parentNode.parentNode.parentNode.querySelector('ul');\n\n\t\ttpl.innerHTML = this.template.\n\t\t\treplace(/IIDDXX/g, idx).\n\t\t\treplace(/KKEEYY/g, ul.querySelectorAll('li').length.toString());\n\n\t\tul.appendChild(tpl.querySelector('li.breakpoint'));\n\t};\n\n\tthis.deleteBreak = function (elem) {\n\n\t\tvar empty = true;\n\t\telem.parentNode.parentNode.querySelectorAll('input').forEach(function (input) { empty = empty && (input.value == ''); });\n\n\t\tif (empty || confirm(Translator.translate('Are you sure?')))\n\t\t\telem.parentNode.parentNode.remove();\n\t};\n\n})();\n\nif (typeof self.addEventListener == 'function')\n\tself.addEventListener('load', maillog.init.bind(maillog));"],"names":["window","NodeList","prototype","forEach","callback","that","i","this","length","call","maillog","template","nextIdx","init","customer","bounce","subscriber","j","document","getElementById","console","info","parseInt","textContent","trim","Math","floor","elem","querySelector","innerHTML","getAttribute","remove","add","code","sys","mag","cnf","value","scrollTop","scrollHeight","selectedIndex","mark","fields","querySelectorAll","indexOf","setAttribute","removeAttribute","decode","data","decodeURIComponent","escape","atob","iframe","contentDocument","parentNode","firstChild","nodeValue","style","height","self","setTimeout","e","resetLifetime","color","toLowerCase","removeLifetime","confirm","Translator","translate","addPicture","tpl","createElement","root","nodeName","replace","appendChild","deletePicture","empty","input","addBreak","idx","ul","toString","deleteBreak","addEventListener","bind"],"mappings":";;;;;GAqBIA;OAAOC,WAAaA,SAASC,UAAUC,UAC1CF,SAASC,UAAUC,QAAU,SAAUC,EAAUC,EAAMC,GAEtD,IADAD,EAAOA,GAAQL,OACVM,EAAI,EAAGA,EAAIC,KAAKC,OAAQF,IAC5BF,EAASK,KAAKJ,EAAME,KAAKD,GAAIA,EAAGC,QAInC,IAAIG,QAAU,IAAI,wBAGjBH,KAAKI,SAAW,KAChBJ,KAAKK,QAAW,EAEhBL,KAAKM,KAAO,WAEX,IAAUC,EAAUC,EAAQC,EAAYV,EAAGW,EAEvCC,SAASC,eAAe,wCAE3BC,QAAQC,KAAK,uBACbP,EAAaI,SAASC,eAAe,uCACrCJ,EAAaG,SAASC,eAAe,qCACrCH,EAAaE,SAASC,eAAe,+CAErCb,EAAIgB,SAASR,EAASS,YAAYC,OAAQ,IAC1CP,EAAIK,SAASP,EAAOQ,YAAYC,OAAQ,IACxCT,EAAOQ,aAAe,KAAOE,KAAKC,MAAU,IAAJT,EAAUX,GAAK,MAEvDA,EAAIgB,SAASR,EAASS,YAAYC,OAAQ,IAC1CP,EAAIK,SAASN,EAAWO,YAAYC,OAAQ,IAC5CR,EAAWO,aAAe,KAAOE,KAAKC,MAAU,IAAJT,EAAUX,GAAK,QAEnDqB,EAAOT,SAASC,eAAe,oDAEvCC,QAAQC,KAAK,uBACbM,EAAOA,EAAKC,cAAc,eAE1BrB,KAAKI,SAAWgB,EAAKE,UACrBtB,KAAKK,QAAWU,SAASK,EAAKG,aAAa,aAAc,IAEzDH,EAAKI,WAIPxB,KAAKyB,IAAM,SAAUC,GAEpB,IAAIC,EAAMhB,SAASC,eAAe,gBAAkBc,EAAO,mBACvDE,EAAMjB,SAASC,eAAe,gBAAkBc,EAAO,qBACvDG,EAAMlB,SAASC,eAAe,gBAAkBc,EAAO,mBAEnC,EAAnBC,EAAIG,MAAM7B,QAAmC,EAAnB2B,EAAIE,MAAM7B,SACxC4B,EAAIC,OAASD,EAAIC,MAAQ,KAAOH,EAAIG,MAAQ,IAAMF,EAAIE,OAAOb,OAC7DY,EAAIE,UAAYF,EAAIG,aACpBL,EAAIM,cAAgB,EACpBL,EAAIK,cAAgB,EACpBjC,KAAKkC,KAAKR,KAIZ1B,KAAKkC,KAAO,SAAUR,GAErB,IAAIS,EAASxB,SAASC,eAAe,gBAAkBc,EAAO,mBAAmBI,MAEjFnB,SAASC,eAAe,gBAAkBc,EAAO,mBAAmBU,iBAAiB,UAAUxC,QAAQ,SAAUwB,IAChE,EAA3Ce,EAAOE,QAAQ,KAAOjB,EAAKU,MAAQ,MAAoD,IAArCK,EAAOE,QAAQjB,EAAKU,MAAQ,KAClFV,EAAKkB,aAAa,QAAS,OAE3BlB,EAAKmB,gBAAgB,WAGvB5B,SAASC,eAAe,gBAAkBc,EAAO,qBAAqBU,iBAAiB,UAAUxC,QAAQ,SAAUwB,IAC1E,EAApCe,EAAOE,QAAQ,IAAMjB,EAAKU,OAC7BV,EAAKkB,aAAa,QAAS,OAE3BlB,EAAKmB,gBAAgB,YAIxBvC,KAAKwC,OAAS,SAAUC,GAEvB,OAAOC,mBAAmBC,OAAOC,KAAKH,MAGvCzC,KAAK6C,OAAS,SAAUzB,GAEvB,IACCA,EAAKmB,gBAAgB,UACrBnB,EAAK0B,gBAAgBzB,cAAc,QAAQ0B,WAAWzB,UAAYtB,KAAKwC,OAAOpB,EAAK4B,WAAWC,WAC9F7B,EAAK8B,MAAMC,OAAS/B,EAAK0B,gBAAgBzB,cAAc,QAAQW,aAAe,KAC9EoB,KAAKC,WAAW,WACf,IAAIjC,EAAOT,SAASU,cAAc,sBAClCD,EAAK8B,MAAMC,OAAS/B,EAAK0B,gBAAgBzB,cAAc,QAAQW,aAAe,MAC5E,KAEJ,MAAOsB,GACNlC,EAAK0B,gBAAgBzB,cAAc,QAAQL,YAAcsC,IAI3DtD,KAAKuD,cAAgB,SAAUnC,EAAMoC,IAEpCpC,EAAOA,EAAK2B,YACPX,iBAAiB,UAAU,GAAGH,cAAgB,EACnDb,EAAKgB,iBAAiB,UAAU,GAAGH,cAAgB,EACnDb,EAAKgB,iBAAiB,SAAS,GAAGN,MAAQ0B,EAAMC,cAChDrC,EAAKgB,iBAAiB,SAAS,GAAGN,MAAQ,WAG3C9B,KAAK0D,eAAiB,SAAUtC,GAE3BuC,QAAQC,WAAWC,UAAU,mBAChCzC,EAAK2B,WAAWvB,UAGlBxB,KAAK8D,WAAa,SAAU1C,GAG3B,IADA,IAAI2C,EAAMpD,SAASqD,cAAc,MAAOC,EAAO7C,EAAK2B,WAC3B,UAAlBkB,EAAKC,UACXD,EAAOA,EAAKlB,WAEbkB,EAAOA,EAAK5C,cAAc,SAE1B0C,EAAIzB,aAAa,QAAS,SAC1ByB,EAAIzC,UAAYtB,KAAKI,SACpB+D,QAAQ,UAAWnE,KAAKK,SACxB8D,QAAQ,UAAW,KAEpBF,EAAKG,YAAYL,GACjB/D,KAAKK,SAAW,GAGjBL,KAAKqE,cAAgB,SAAUjD,GAE9B,IAAIkD,GAAQ,EACZlD,EAAK2B,WAAWA,WAAWX,iBAAiB,SAASxC,QAAQ,SAAU2E,GAASD,EAAQA,GAAyB,IAAfC,EAAMzC,SAEpGwC,GAASX,QAAQC,WAAWC,UAAU,oBACzCzC,EAAK2B,WAAWA,WAAWvB,UAG7BxB,KAAKwE,SAAW,SAAUpD,EAAMqD,GAE/B,IAAIV,EAAMpD,SAASqD,cAAc,MAAOU,EAAKtD,EAAK2B,WAAWA,WAAWA,WAAW1B,cAAc,MAEjG0C,EAAIzC,UAAYtB,KAAKI,SACpB+D,QAAQ,UAAWM,GACnBN,QAAQ,UAAWO,EAAGtC,iBAAiB,MAAMnC,OAAO0E,YAErDD,EAAGN,YAAYL,EAAI1C,cAAc,mBAGlCrB,KAAK4E,YAAc,SAAUxD,GAE5B,IAAIkD,GAAQ,EACZlD,EAAK2B,WAAWA,WAAWX,iBAAiB,SAASxC,QAAQ,SAAU2E,GAASD,EAAQA,GAAyB,IAAfC,EAAMzC,SAEpGwC,GAASX,QAAQC,WAAWC,UAAU,oBACzCzC,EAAK2B,WAAWA,WAAWvB,WAKM,mBAAzB4B,KAAKyB,kBACfzB,KAAKyB,iBAAiB,OAAQ1E,QAAQG,KAAKwE,KAAK3E"}