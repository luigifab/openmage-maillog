/*!
 * Copyright 2015-2023 | Fabrice Creuzot (luigifab) <code~luigifab~fr>
 * https://github.com/luigifab/openmage-maillog
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t,o){for(t=t||window,o=0;o<this.length;o++)e.call(t,this[o],o,this)}),Element.prototype.closest||(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;if(document.documentElement.contains(t))do{if(t.matches(e))return t}while(null!==(t=t.parentElement||t.parentNode)&&1==t.nodeType);return null});var maillog=new function(){"use strict";this.template=null,this.nextIdx=0,this.init=function(){var e,t,o,r,l;document.getElementById("maillog_sync_bounces_stats_customer")?(console.info("maillog.app - hello"),e=document.getElementById("maillog_sync_bounces_stats_customer"),t=document.getElementById("maillog_sync_bounces_stats_bounce"),o=document.getElementById("maillog_sync_unsubscribers_stats_subscriber"),r=parseInt(e.textContent.trim(),10),l=parseInt(t.textContent.trim(),10),t.textContent+=" ("+Math.floor(100*l/r)+" %)",r=parseInt(e.textContent.trim(),10),l=parseInt(o.textContent.trim(),10),o.textContent+=" ("+Math.floor(100*l/r)+" %)"):(t=document.getElementById("row_maillog_directives_general_special_config"))&&(console.info("maillog.app - hello"),t=t.querySelector("tr.template"),this.template=t.innerHTML,this.nextIdx=parseInt(t.getAttribute("data-next"),10),t.remove())},this.add=function(e){var t=document.getElementById("maillog_sync_"+e+"_mapping_system"),o=document.getElementById("maillog_sync_"+e+"_mapping_openmage"),r=document.getElementById("maillog_sync_"+e+"_mapping_config");0<t.value.length&&0<o.value.length&&(r.value=(r.value+"\n"+t.value+":"+o.value).trim(),r.scrollTop=r.scrollHeight,t.selectedIndex=0,o.selectedIndex=0,this.mark(e))},this.mark=function(e){var t=document.getElementById("maillog_sync_"+e+"_mapping_config").value;document.getElementById("maillog_sync_"+e+"_mapping_system").querySelectorAll("option").forEach(function(e){-1<t.indexOf("\n"+e.value+":")||0===t.indexOf(e.value+":")?e.setAttribute("class","has"):e.removeAttribute("class")}),document.getElementById("maillog_sync_"+e+"_mapping_openmage").querySelectorAll("option").forEach(function(e){-1<t.indexOf(":"+e.value)?e.setAttribute("class","has"):e.removeAttribute("class")})},this.decode=function(e){return decodeURIComponent(escape(atob(e)))},this.iframe=function(t){try{t.removeAttribute("onload"),t.contentDocument.querySelector("body").parentNode.innerHTML=this.decode(t.firstChild.nodeValue),t.style.height=t.contentDocument.querySelector("body").scrollHeight+"px",self.setTimeout(function(){var e=document.querySelector("div.content iframe");e.style.height=e.contentDocument.querySelector("body").scrollHeight+"px"},1e3)}catch(e){t.contentDocument.querySelector("body").textContent=e}},this.resetValues=function(e){(e=e.closest("li, tr")).querySelectorAll("select, input").forEach(function(e){"SELECT"===e.nodeName?e.selectedIndex=e.querySelector("option[selected]").index:e.color?(e.value=e.defaultValue.toUpperCase(),e.color.importColor()):e.jscolor?(e.value=e.defaultValue.toUpperCase(),e.jscolor.fromString(e.value)):e.value=e.defaultValue,e.classList.contains("h")&&(e=e.closest("li").querySelector("div.rt"))&&this.ratioPicture(e)},this)},this.defaultLifetime=function(e,t,o){(e=e.parentNode).querySelectorAll("select")[0].selectedIndex=0,e.querySelectorAll("select")[1].selectedIndex=0;var r=e.querySelectorAll("input")[0];r.value=t.toUpperCase(),r.color?r.color.importColor():r.jscolor.fromString(r.value),(r=e.querySelectorAll("input")[1]).value=o.toUpperCase(),r.color?r.color.importColor():r.jscolor.fromString(r.value)},this.removeLifetime=function(e){confirm(Translator.translate("Are you sure?"))&&e.parentNode.remove()},this.addPicture=function(e){for(var t,o=document.createElement("tr"),r=e.parentNode;"TABLE"!==r.nodeName;)r=r.parentNode;return r=r.querySelector("tbody"),o.setAttribute("class","added"),o.setAttribute("data-idx",this.nextIdx.toString()),o.innerHTML=this.template.replace(/IIDDXX/g,this.nextIdx).replace(/KKEEYY/g,"1"),r.querySelector("tr.new")||((e=document.createElement("tr")).setAttribute("class","letter new"),(t=document.createElement("td")).setAttribute("colspan","2"),t.setAttribute("class","a-center"),t.appendChild(document.createTextNode("-")),e.appendChild(t),r.appendChild(e)),r.appendChild(o),o.querySelector("input").focus(),this.nextIdx+=1,o},this.ratioPicture=function(e){var e=e.closest("li"),t=parseInt(e.querySelector("input.w").value,10),o=parseInt(e.querySelector("input.h").value,10);e.querySelector("div.rt").innerHTML=isNaN(t)||isNaN(o)||0==t||0==o?"":(Math.round(100*(t/o+(Number.EPSILON||0)))/100).toLocaleString()},this.copyPicture=function(e,t){var o,r={};if(e.closest("tr").querySelectorAll("input").forEach(function(e){o=(o=e.name.replace("groups[general][fields][special_config][value][","").replace(/]\[/g,":").replace("]","")).substring(o.indexOf(":")+1),r[o]=e.value}),r=JSON.stringify(r),!0===t)return r;"object"==typeof navigator.clipboard?navigator.clipboard.writeText(r).then(function(){e.closest("tr").classList.add("maillog-flash"),self.setTimeout(function(){e.closest("tr").classList.remove("maillog-flash")},1e3)},function(){self.prompt("copy",r)}):self.prompt("copy",r)},this.pastePicture=function(t,o,r){var l,n,e,i=1;r=!0===r;try{l=JSON.parse((o.clipboardData||window.clipboardData).getData("text")),o.preventDefault()}catch(e){return void(r&&(console.error(e),o.preventDefault(),t.value=""))}if(t.closest("table").querySelectorAll("input.cde").forEach(function(e){e.value==l.c&&(n=e.closest("tr"))}),n=!n&&t.classList.contains("cde")?t.closest("tr"):n){if(!confirm(Translator.translate("Are you sure?")+" (paste/replace picture "+l.c+")"))return}else n=this.addPicture(document.querySelector("button.add.picture"));for(n.querySelector("input.cde").value=l.c,n.querySelector("input.cmt").value=l.d,n.querySelector("li.default input.w").value=l["0:w"],n.querySelector("li.default input.h").value=l["0:h"],this.ratioPicture(n.querySelector("li.default")),n.querySelectorAll("li.breakpoint").forEach(function(e){e.remove()});l[i+":b"];)(e=this.addBreak(n.querySelector("button.add.break"),!1)).querySelector("input.b").value=l[i+":b"],e.querySelector("input.w").value=l[i+":w"],e.querySelector("input.h").value=l[i+":h"],this.ratioPicture(e),i++;self.scrollTo(0,n.getBoundingClientRect().top+self.scrollY-150),n.querySelector("input").focus(),n.closest("tr").classList.add("maillog-flash"),self.setTimeout(function(){n.closest("tr").classList.remove("maillog-flash")},1e3)},this.removePicture=function(e){var t=!0;e.closest("tr").querySelectorAll("input").forEach(function(e){t=t&&""==e.value}),(t||confirm(Translator.translate("Are you sure?")+" (remove picture)"))&&e.closest("tr").remove()},this.addBreak=function(e,t){var o=document.createElement("ul"),r=e.closest("td").querySelector("ul");return o.innerHTML=this.template.replace(/IIDDXX/g,e.closest("tr").getAttribute("data-idx")).replace(/KKEEYY/g,r.querySelectorAll("li").length.toString()),o=o.querySelector("li.breakpoint"),r.appendChild(o),!1!==t&&o.querySelector("input").focus(),o},this.removeBreak=function(e){var t=!0;e.closest("li").querySelectorAll("input").forEach(function(e){t=t&&""==e.value}),(t||confirm(Translator.translate("Are you sure?")+" (remove breakpoint)"))&&e.closest("li").remove()}};"function"==typeof self.addEventListener&&self.addEventListener("load",maillog.init.bind(maillog));
//# sourceMappingURL=app.min.js.map