<?xml version="1.0" encoding="utf-8"?>
<!--
 * Created D/22/03/2015
 * Updated J/08/07/2021
 *
 * Copyright 2015-2021 | Fabrice Creuzot (luigifab) <code~luigifab~fr>
 * Copyright 2015-2016 | Fabrice Creuzot <fabrice.creuzot~label-park~com>
 * Copyright 2017-2018 | Fabrice Creuzot <fabrice~reactive-web~fr>
 * Copyright 2020-2021 | Fabrice Creuzot <fabrice~cellublue~com>
 * https://www.luigifab.fr/openmage/maillog
 *
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL) as published
 * by the free software foundation, either version 2 of the license, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but without any warranty, without even the implied warranty of
 * merchantability or fitness for a particular purpose. See the
 * GNU General Public License (GPL) for more details.
-->

<config>
	<modules>
		<Luigifab_Maillog>
			<version>5.1.2</version>
		</Luigifab_Maillog>
	</modules>
	<global>
		<blocks>
			<maillog>
				<class>Luigifab_Maillog_Block</class>
			</maillog>
		</blocks>
		<helpers>
			<maillog>
				<class>Luigifab_Maillog_Helper</class>
			</maillog>
		</helpers>
		<models>
			<maillog>
				<class>Luigifab_Maillog_Model</class>
				<resourceModel>maillog_resource</resourceModel>
				<adaptators>
					<dolist>Luigifab_Maillog_Model_System_Dolist</dolist>
					<emarsys>Luigifab_Maillog_Model_System_Emarsys</emarsys>
				</adaptators>
			</maillog>
			<maillog_resource>
				<class>Luigifab_Maillog_Model_Resource</class>
				<entities>
					<email>
						<table>luigifab_maillog</table>
					</email>
					<sync>
						<table>luigifab_maillog_sync</table>
					</sync>
				</entities>
			</maillog_resource>
			<core>
				<rewrite>
					<email_queue>Luigifab_Maillog_Model_Rewrite_Queue</email_queue>
				</rewrite>
			</core>
			<newsletter>
				<rewrite>
					<subscriber>Luigifab_Maillog_Model_Rewrite_Subscriber</subscriber>
				</rewrite>
			</newsletter>
			<newsletter_resource>
				<rewrite>
					<subscriber>Luigifab_Maillog_Model_Rewrite_Subscriberres</subscriber>
				</rewrite>
			</newsletter_resource>
		</models>
		<resources>
			<maillog_setup>
				<setup>
					<module>Luigifab_Maillog</module>
					<class>Mage_Eav_Model_Entity_Setup</class>
				</setup>
				<connection>
					<use>core_setup</use>
				</connection>
			</maillog_setup>
		</resources>
		<template>
			<email>
				<maillog_email_template translate="label">
					<label>Sent email report</label>
					<file>maillog_report.html</file>
					<type>html</type>
				</maillog_email_template>
			</email>
		</template>
		<events>
			<customer_delete_after>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>customerDeleteSync</method>
					</maillog>
				</observers>
			</customer_delete_after>
			<customer_save_commit_after>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>customerSaveSync</method>
					</maillog>
				</observers>
			</customer_save_commit_after>
			<newsletter_subscriber_save_after>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>subscriberSaveSync</method>
					</maillog>
				</observers>
			</newsletter_subscriber_save_after>
			<newsletter_subscriber_delete_after>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>subscriberDeleteSync</method>
					</maillog>
				</observers>
			</newsletter_subscriber_delete_after>
			<sales_order_invoice_save_commit_after>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>orderInvoiceSync</method>
					</maillog>
				</observers>
			</sales_order_invoice_save_commit_after>
		</events>
	</global>
	<frontend>
		<events>
			<customer_login>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>customerLoginSync</method>
					</maillog>
				</observers>
			</customer_login>
			<customer_address_save_after>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>addressSaveSync</method>
					</maillog>
				</observers>
			</customer_address_save_after>
		</events>
		<routers>
			<maillog>
				<use>standard</use>
				<args>
					<module>Luigifab_Maillog</module>
					<frontName>maillog</frontName>
				</args>
			</maillog>
		</routers>
	</frontend>
	<admin>
		<routers>
			<adminhtml>
				<args>
					<modules>
						<Luigifab_Maillog before="Mage_Adminhtml">Luigifab_Maillog</Luigifab_Maillog>
					</modules>
				</args>
			</adminhtml>
		</routers>
	</admin>
	<adminhtml>
		<events>
			<admin_system_config_changed_section_maillog>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>updateConfig</method>
					</maillog>
				</observers>
			</admin_system_config_changed_section_maillog>
			<admin_system_config_changed_section_maillog_sync>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>updateConfig</method>
					</maillog>
				</observers>
			</admin_system_config_changed_section_maillog_sync>
			<adminhtml_customer_prepare_save>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>setCustomerStoreId</method>
					</maillog>
				</observers>
			</adminhtml_customer_prepare_save>
			<newsletter_subscriber_save_before>
				<observers>
					<maillog>
						<class>maillog/observer</class>
						<method>setSubscriberStoreId</method>
					</maillog>
				</observers>
			</newsletter_subscriber_save_before>
		</events>
		<layout>
			<updates>
				<maillog>
					<file>luigifab/maillog.xml</file>
				</maillog>
			</updates>
		</layout>
		<translate>
			<modules>
				<Luigifab_Maillog>
					<files>
						<default>Luigifab_Maillog.csv</default>
					</files>
				</Luigifab_Maillog>
			</modules>
		</translate>
	</adminhtml>
	<crontab>
		<jobs>
			<maillog_send_report>
				<run>
					<model>maillog/observer::sendEmailReport</model>
				</run>
			</maillog_send_report>
			<maillog_clean_old_data>
				<run>
					<model>maillog/observer::cleanOldData</model>
				</run>
			</maillog_clean_old_data>
			<maillog_bounces_import>
				<run>
					<model>maillog/observer::bouncesFileImport</model>
				</run>
			</maillog_bounces_import>
			<maillog_unsubscribers_import>
				<run>
					<model>maillog/observer::unsubscribersFileImport</model>
				</run>
			</maillog_unsubscribers_import>
		</jobs>
	</crontab>
	<default>
		<maillog>
			<general>
				<send>1</send>
				<encoding>quoted-printable</encoding>
				<subject>1</subject>
				<created>1</created>
			</general>
			<filters>
				<notbaseurl>dev test preprod</notbaseurl>
			</filters>
			<email>
				<enabled>0</enabled>
				<recipient_email>hello@example.org</recipient_email>
				<sender_email_identity>general</sender_email_identity>
			</email>
			<bounces>
				<cron_expr>30 2 * * *</cron_expr>
			</bounces>
			<unsubscribers>
				<cron_expr>30 2 * * *</cron_expr>
			</unsubscribers>
		</maillog>
		<maillog_directives>
			<general>
				<!-- font_size = self.getComputedStyle(document.documentElement).fontSize -->
				<font_size>16</font_size>
			</general>
		</maillog_directives>
		<newsletter>
			<subscription>
				<success_send>1</success_send>
				<un_send>1</un_send>
			</subscription>
		</newsletter>
	</default>
</config>